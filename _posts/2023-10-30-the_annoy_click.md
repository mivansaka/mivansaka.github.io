---
layout: post
title: 和智能开关搏斗
date: 2023-10-28 10:28:09 +0800
---
> 家里的智能灯装完，但是都接在普通开关上，暂时还没有预算换成智能开关，现在半夜起来上厕所要喊siri开灯，老婆想杀了我

在装修的时候就筹划着想在家里能够改造成智能家居的地方就改造成智能家居，凭借着原先和各种esp8266这类产品打交道的基础，我总觉得很多事情可以自己搞定，所以也就没有在装修公司全包的时候提起，总觉得他们所做的事情在这方面经验肯定不足或许和我一样是一个半吊子。而类似于aqara全屋智能的咨询我也没有考虑过，交给他们肯定一把子更放心，但是显然我的钱包不允许我这么做。~~何况咸鱼上的aqara二道贩子的价格真的很低很吸引人~~

家中的灯具配置如下：
- 客餐厅
	1. 顶灯：yeelight 吸顶灯 1个 
	2. 落地灯：nanoleaf essentials bulb 1个
	3. 玄关灯：普通灯泡 1 个
	4. 餐厅主灯：普通灯泡 1 个
	5. 餐厅射灯：aqara 射灯 2 个
	6. 窗帘：aqara 窗帘伴侣 1 个
* 主卧
	1. 顶灯：yeelight 吸顶灯 1 个
	2. 壁灯：普通灯泡 1 个
* 次卧
	1. 顶灯：yeelight吸顶灯 1 个
	2. 床头射灯：aqara 射灯 2 个
	3. 台灯：小米台灯 1 个
	4. aqara 窗帘伴侣 1 个
	5. nanoleaf essentials 灯带 1 个
* 卫生间
	1. 洗手台射灯：aqara 射灯 2 个
	2. 马桶射灯：aqara 射灯 1 个
	3. 浴室灯：普通灯泡 1 个
* 厨房
	1. 水槽射灯：aqara 射灯 1 个
	2. 厨房主灯：普通灯泡 1 个

上面是家里涉及到的大部分灯具和智能产品，其他例如小米的扫地机器人和冰箱这类 IOT 产品虽说也是智能家电，但是实际上体验感知和使用上难度不大，并不需要我去进行「搏斗」。

**品牌倾向性**
很明显能看出我对品牌的倾向性是有的，家中的顶灯都选用了个人感觉上在做灯这方面比较专业的yeelight，但是在某些只有装饰作用或者对光照要求并不太高的射灯上我选用的是 aqara 的射灯，没有其他的缘由，仅仅是因为要同时满足*射灯、支持homekit、大品牌* 这三个方面的选项似乎只有 aqara 这一个选项，并且之前我已经有 aqara 的空调伴侣和监控摄像头可以用作网关，可以省下单独购买网关的钱。nanoleaf 算是例外，仅仅是因为在Apple store的展台上看见了他们摆出来，价格也不算很高，不需要网关可以独立运行才买的，算是旧物利用。

**一些基础的设定**
Aqara ：国产智能家居的厂商中aqara算得上是两头都占的厂家，脱胎于小米系的同时对于Apple的homekit生态也是一种积极拥抱的姿态，新出的产品不用特别提及基本上是支援homekit的。设置起来很直接，先在他们自家的aqara home app里面添加好网关，会跳转到iOS的home里进行二次的设置，之后的zigbee配件也一并添加进去就可以了，加入的配件也会在home app里面一并展现。很舒服的是我买的T3射灯全部支援homekit新增的 adaptive lighting 功能，不用额外的操心。

yeelight：yeelight 很直接地只支援米家的生态，但是借助于跑在我树莓派上的home assistant中的Miot插件，也能很舒服地将yeelight的顶灯加入进我的homekit生态中，很遗憾的是这样方式加入home应用中的灯是不支援 adaptive lighting 的功能的，就会造成一件很尴尬的事情：大部分房间都是aqara和yeelight混搭的，如果不支持adaptive lighting的话家中灯光全开时色温就会乱得一塌糊涂，手动调节也不方便。之后的解决方案是在home assistant中再加入一个adaptive lighting插件，用home assistant来强行给这些顶灯赋予adaptive lighting的功能，单独在home中增设一个开关来决定是不是要开启。

nanoleaf：作为在Apple Store的展示柜中摆出的平价产品，自然对于homekit的支援是十分友好的，不需要独立的app，电灯接上电，打开home应用，跟随整个homekit配件添加的引导就好了。当然他家也是有独立的app，里面有十分多钟的灯光预设，~~比如一键让你家看上去像个夜店一样~~。

**开关的问题**
装修公司把这个家交付验收给了我以后的配置就是上面所属的所有东西加上普通开关的组合。如今搬进家中也近乎两个星期了，该收拾的东西收拾得差不多，准备在这方面做出一些推进了。因为没有从根源来考虑这份规划所以即使我在装修时就已经将家里所有的光源都采用了智能灯，但是**智能灯+普通开关**的方式实在不是一种合理的选择，这意味着如果你需要智能控制则舍弃了所有的实体按键的触感，完全依赖于手机和HomePod；如果使用实体按键，那么购入这些智能灯具所承受的溢价会让我看上去像个傻子一样。

那么配上传统的智能开关会如何呢？传统的智能开关可以理解为一个既可以手动控制也可以手机控制的继电器，按下一次就控制内部的继电器开/关一次这样就会带来一个问题，开关关闭后确实灯是能够被开关的，不过只是作为普通灯具来使用的开关，家中灯全关上以后齐刷刷十几个灯具配件全部无响应的状况肯定是让人抓狂的。

传统的智能开关必然是满足不了这样复杂的情景了，不过型号国产厂家够给力，推出了一些新的技术来兼容这样的情况，yeelight 叫做凌动开关，aqara 叫做火星技术，都是能够兼容智能灯和开关的这种冲突，大致挑了挑我就相中了aqara 出品的新品「卡农开关」。这也是我和智能开关搏斗的开端。

这款宣传中包含了「火星技术」、「智能判断零火状态」新功能并且单个价格在闲鱼上只要一百出头的开关看上去似乎满足了我所有的需求。拿到手以后才知道：「火星技术」的前提是这个开关要接入**零线**。电灯的一头接入零线一头接入火线，而一般的开关只是安装在电灯的火线上负责通断，因此开关本身并不需要通电，但是智能开关不一样，只有一根火线和电灯的控制线的话一旦火线与零线断开不形成回路的话开关是获取不了电力的，因此对于需要「火星技术」的智能开关来说，需要一根零线自身接到家庭的电路环境中去，而不是和电灯串联到一起。

一般的家庭装修中的开关盒中是不会预留出零线来的，在aqara的产品介绍详情页中也没有对「火星技术」的详细说明，我以为aqara研制出了什么新技术能够对只有火线的家庭也能支援出和智能灯的联动。终于定下的卡农开关到了货，打开看到里面的接线组成依旧是【N\L\L1】这样的组成形式，我按照一般的单火线的接法顺利让这个开关启用了，和普通的智能开关并无二致，问题就出现了：宣传页上的「火星技术」到底在哪里。我翻遍了应用的设置里面找不到选项的设置，只能赶紧去询问aqara的客服，得到了一个我隐隐猜到的结论：

>**这个开关的「火星技术」需要把零线也接入进去**

我的第一反应是我买的将近900块钱的开关钱可能有一半要打水漂了，未来家里的使用也要忍受长期无响应的折磨，但是我依旧是有一点点的不甘心，在装开关的时候似乎在漆黑的接线盒里面有三股拧在一起的、端头用电工胶带封好的蓝色的线。这三根线也许就是我的希望。

最初更换的是三个开关，分别控制卫生间的射灯和厨房的射灯，对于我这家装修公司来说（不确定是不是普遍现象），设计师只负责在俯视图上规划点位，而不会细化到具体的走线图纸，现场放多少线，怎么放完全看电工师傅的规划了，本来想能拿到图纸以后再仔细分析电路走线，现在看似乎是不可能的了，只能按照一般习惯的「红色火线、蓝色零线」的思路来想了。把三个开关再拆下来然后按照实际来看看里面的走线。

拆下开关先发现的问题是火线的问题，三个开关的位置其中两个是并排放置，另外一个开关在卫生间的马桶旁边，而电工师傅或许是为了偷懒还是省材料，这三个开关使用的其实是同一根红色的火线，先把火线接到第一个开关上，再从开关的火线孔拉一根线拉到旁边的开关的火线孔当火线用，之后再从旁边开关的火线孔中拉出一根线穿过墙壁来到卫生间的开关上。这也许只是不规范，但是也能用，略微吐槽之后再来看拧在一起的三根蓝色零线，因为沒有电路图，我只能猜测这三根零线就是师傅预留进去的对应三个开关的零线（其实也许我是赚了的，因为如果提前和装修公司说要有智能开关留出零线是要另外加钱的）。我把三根零线拆开，其中的两根分出来到并排摆放的两个开关盒里给智能开关接上N孔，另外厕所的开关因为要穿墙比较麻烦就先不弄了。很惊喜，洗手池的射灯开关在接上了零线以后在aqara home的设置里面能够立即看到「火星技术」的选项，选择和洗手池射灯的配件对应上之后我终于看到了我所想的完美的效果：

>按下开关后射灯开/关，而在app中显示的灯的状态是关闭而非离线，使用home或者siri控制灯的亮灭所接的开关配件的状态也一同更新。

本以为这样就完美解决了问题，刚好三根零线解决我三个开关，但是设置完一个开关的我检查时发现，同样接了蓝色线的旁边的开关并没有识别到零火模式，而且一旦洗手池射灯的开关切到关闭，旁边的开关就完全瘫痪，普通开关的能力都做不到。我立刻找来测电笔来测试每个点的通电情况。结果发现，洗手池射灯的开关一旦我选择关闭，隔壁的那根零线就会带电，它，变成了一根火线。

从收到开关开始安装，到现在的突破一点点已经耗费了我一晚上加早上一个小时的时间了（当然我有好好睡觉），要赶紧赶去上班，手机上匆忙给老婆道了歉，说明了一下现在的情况，并且保证一定能搞好，再不济就换回普通开关来用。

中午休息的时候找到装修经理，让他帮忙联系了一下当时的电工：
「师傅，你开关盒里面留的是不是三根零线？」
「是，当时留在里面的」
「那为啥我现在三根零线拆出来里面有一根带电啊？」
「啊？咋可能带电，你让我看看」
「就是带电的啊」
「我当时三根线是拧在一起的，我这么做肯定是有道理的，你把他们拆开来干什么？这肯定会有问题的啊」

终于，我破解了这个问题，这三根蓝线拧在一起的时候就是根零线，而我现在要做的就是把这三根零线再接在一起，从里面再分出三根零线出来供给我的三个开关的零线接口。我立马去小区旁边的五金店里买来电线、电工胶布、剥线钳回家开始动手。

和搞清楚线路和原理以后预想的情况还是不太一样，主要还是动手上的问题，师傅一开始拧在一起的三股线拧得很漂亮，但是我还要再拧上去三根线分开到三个不同的开关盒中，狭小的开关盒的空间里面承担了太多的线导致操作起来非常困难；我拧的线也很难看，but it works，谢天谢地。

前面提到的单独的需要穿墙的卫生间的开关，我试了试从预留的管子中把接好的线穿过去，但也许是有拐弯的地方，硬直的线捅进去一段长度后就无法再往里进了，只能够另辟蹊径。在卫生间的开关的旁边是接着浴霸的开关，我再把那个浴霸的开关拆下来，果然从里面找到了一根蓝蓝的线，从这再分出一股，分到了卫生间的开关盒里面。

通电，至此我的三个开个和我的三组灯终于获得了他们应有的智能和物理意义上的开关；喜欢喊Siri的我和喜欢用手按开关的老婆都获得了自己的满足。

这就是我到现在和智能开关搏斗的全过程，进度也仅仅是三个开关而已，主要的客厅和卧室的开关还没有替换掉，后面还有一段漫漫长路。

我老婆曾经问我，你就这么懒得按开关吗？这个问题我也不知道怎么回答，为什么要爬山只是因为山在那里，没有什么答案，可能我在折腾这样的智能家居里能够获得更多的一点对家里的掌控感，也可能是能够在智能家居的兴趣上面获得一些实操感，看着这三个开关和手机上流畅的控制，我感觉自己的多巴胺还是多分泌了一点。

不过最后要说的是，不管你再怎么喜欢折腾，再怎么喜欢去做一些奇奇怪怪的事情，永远都要在意身边人的心情，就像我绝对不会强迫老婆一直使用手机来开关灯，如果这件事情搞不定我还是会把开关换回普通的开关，永远不要因为自己的爱好去影响别人的生活。


